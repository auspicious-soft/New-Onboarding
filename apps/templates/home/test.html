{% extends "layouts/base.html" %}

{% block title %} Employee Form {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<section class="section section-lg">
    <div class="container">
        <div class="row justify-content-center">
            <h2 id="heading">Employee/Contractor Information Form</h2>
            <p>Fill all form field to go to next step</p>
            <form id="employeeForm" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <!-- progressbar -->
                <ul id="progressbar">
                    <li class="active" id="account"><strong>Employee Details</strong></li>
                    <li id="personal"><strong>Employee Documents</strong></li>
                </ul>
                <!-- <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                </div> <br>  -->
                <fieldset>
                    <div class="form-card">
                        <div class="row">
                            <div class="col-7">
                                <h2 class="fs-title">Employee Details:</h2>
                            </div>
                            <div class="col-5">
                                <h2 class="steps">Step 1 - 2</h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Bussiness Name: *</label> 
                                <input type="text" name="bussiness_name" placeholder="Bussiness Name" /> 
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">ABN: *</label> 
                                <input type="text" name="abn" placeholder="ABN" /> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">First Name: *</label> 
                                <input type="text" name="first_name" placeholder="First Name" /> 
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Last Name: </label> 
                                <input type="text" name="last_name" placeholder="Last Name" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Middle Name: </label> 
                                <input type="text" name="middle_name" placeholder="Middle Name" /> 
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Date of Birth: </label> 
                                <input type="date" name="dob" placeholder="Date of Birth" /> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 col-sm-12">
                                <label class="fieldlabels">Search Address: </label> 
                                <input type="text" name="search_address" placeholder="Search Address" /> 
                                
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 col-sm-12">
                                <label class="fieldlabels">Street Address: *</label> 
                                <textarea class="form-control" rows="2" name="street_address" placeholder="Street Address"></textarea>
                                <!-- <input type="text" name="street_address" placeholder="Street Address" required />  -->
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Suburb/City: </label> 
                                <input type="text" name="city" placeholder="Suburb/City" /> 
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Country: </label> 
                                <input type="text" name="country" placeholder="Country" />
                            </div>
                        </div>
                        <div class="row">
                            <hr>
                            <div class="col-md-12 col-sm-12">Account Details</div>
                            
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">BSB: *</label> 
                                <input type="text" name="bsb" placeholder="BSB"/> 
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <label class="fieldlabels">Account Number: *</label> 
                                <input type="text" name="account_number" placeholder="Account Number" />
                            </div>
                        </div>
                    </div>
                    <input type="button" name="next" class="next action-button" value="Next" />
                    <input type="reset" name="cancel" class="action-button" value="Cancel" />
                </fieldset>
                <fieldset>
                    <div class="form-card">
                        <div class="row">
                            <div class="col-7">
                                <h2 class="fs-title">Employee Documents:</h2>
                            </div>
                            <div class="col-5">
                                <h2 class="steps">Step-2</h2>
                            </div>
                        </div> 
                        <div class="row">
                            <div class="col-xs-4 col-md-4">
                                
                                <h3> Selected Certificate </h3>  
                                <img class="img-responsive" src="{{ ASSETS_ROOT }}/img/c.jpg" alt="Brain Image" width="960" height="600">
                            </div>
                            <div class="col-xs-8 col-md-8">
                                <div class = "container">  
                                    <h3> Employee/Contractor Information </h3>  
                                    <form>  
                                        <div class="row divBorder"> 
                                            <legend>CPR Certificate</legend>
                                            <input type="hidden" name="cpr_certificate">
                                            <div class="col-5">
                                                <label class="" for="Number">
                                                    Number</label>
                                                <div class="input-group">
                                                    <input type="number" name="number[]" class="form-control" 
                                                        placeholder="Number">
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <label class="" for="Expiry Date">
                                                    Expiry Date</label>
                                                <div class="input-group">
                                                    <input type="date" name="expiry_date[]" class="form-control" 
                                                        placeholder="Expiry Date">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <label class="" for="Attach file">
                                                    Attach File</label>
                                                <div class="input-group">
                                                    <input  type="file" name="fileupload[]" id="file_upload_id"  accept=".jpg,.png,"  /> 
                                                    <button id="upload-button" onchange="uploadFile()"> Upload </button>
                                                    <!-- <i class="fa fa-upload upload_file_icon" id="upload-button" onclick="uploadFile()"></i> -->
                                                    <!-- <input type="file" name="file[]" id="file_upload_id"  accept=".jpg,.png," style="display:none">
                                                    <i id="icon_upload" class="fa fa-upload upload_file_icon" onclick="uploadFile()"></i> -->

                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row divBorder"> 
                                            <legend>First Aid Certificate</legend>
                                            <input type="hidden" name="first_aid_certificate">
                                            <div class="col-4">
                                                <label class="" for="Number">
                                                    Number</label>
                                                <div class="input-group">
                                                    <input type="number" name="number[]" class="form-control" 
                                                        placeholder="Number">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <label class="" for="Issue Date">
                                                    Issue Date</label>
                                                <div class="input-group">
                                                    <input type="date" name="expiry_date[]" class="form-control" 
                                                        placeholder="Issue Date">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <label class="" for="Expiry Date">
                                                    Expiry Date</label>
                                                <div class="input-group">
                                                    <input type="date" name="expiry_date[]" class="form-control" 
                                                        placeholder="Expiry Date">
                                                </div>
                                            </div>
                                            <div class="col-2">
                                                <label class="" for="Attach file">
                                                    Attach File</label>
                                                <div class="input-group">
                                                    <!-- <input type="file" name="file[]" class="form-control" 
                                                        placeholder="Attach File"> -->
                                                        <input type="file" name="file[]" id="file_upload_id"  accept=".txt,.jpg,.png,.pdf" >
                                                        <i id="icon_upload" class="fa fa-upload upload_file_icon" onclick="uploadFile()"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row divBorder"> 
                                            <legend>Insurance Certificate</legend>
                                            <input type="hidden" name="insurance_certificate">
                                            <div class="col-5">
                                                <label class="" for="Number">
                                                    Number</label>
                                                <div class="input-group">
                                                    <input type="number" name="number[]" class="form-control" 
                                                        placeholder="Number">
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <label class="" for="Expiry Date">
                                                    Expiry Date</label>
                                                <div class="input-group">
                                                    <input type="date" name="expiry_date[]" class="form-control" 
                                                        placeholder="Expiry Date">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <label class="" for="Attach file">
                                                    Attach File</label>
                                                <div class="input-group">
                                                    <!-- <input type="file" name="file[]" class="form-control" 
                                                        placeholder="Attach File"> -->
                                                        <input type="file" name="file[]" id="file_upload_id"  accept=".txt,.jpg,.png,.pdf" >
                                                        <i id="icon_upload" class="fa fa-upload upload_file_icon" onclick="uploadFile()"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row divBorder"> 
                                            <legend>Agreement</legend>
                                            <input type="hidden" name="agreement">
                                            <div class="col-5">
                                                <label class="" for="Number">
                                                    Number</label>
                                                <div class="input-group">
                                                    <input type="number" name="number[]" class="form-control" 
                                                        placeholder="Number">
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <label class="" for="Expiry Date">
                                                    Expiry Date</label>
                                                <div class="input-group">
                                                    <input type="date" name="expiry_date[]" class="form-control" 
                                                        placeholder="Expiry Date">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <label class="" for="Attach file">
                                                    Attach File</label>
                                                <div class="input-group">
                                                    <!-- <input type="file" name="file[]" class="form-control" 
                                                        placeholder="Attach File"> -->
                                                    <input type="file" name="file[]" id="file_upload_id"  accept=".txt,.jpg,.png,.pdf" >
                                                        <i id="icon_upload" class="fa fa-upload upload_file_icon" onclick="uploadFile()"></i>
                                                </div>
                                            </div>
                                        </div> 
                                    </form>  
                                </div>  
                            </div>
                        </div>
                    </div> 
                    <input type="submit" class="action-button" value="Submit" /> 
                    <input type="button" name="previous" class="previous action-button-previous" value="Previous" />
                </fieldset>
            </form>
        </div>
    </div>
</section>


  <!-- Ajax JavaScript File Upload Logic -->
  <script>
  async function uploadFile() {
  let formData = new FormData(); 
  const csrfToken = document.querySelector('input[name=csrfmiddlewaretoken]').value
  formData.append("file", fileupload.files[0]);
  await fetch('{% url "employee_document_api" %}', {
    method: "POST", 
    body: formData,
    headers: {'X-CSRFToken' : csrfToken}
  }) 
//   .then((response) => {
//             debugger
//             if(!response.ok) {
//                 return response.text().then(text => { throw new Error( "Incorrect Username / Password please try again.") })
//             } else {
//                 return response.text()
//             }
//         })
//         .then((result) => {
//             console.log("====",result)
//             debugger
//             location.reload()
//         })
//         .catch((err) => {
//             $(".error_msg").text(err)
//         })
  }
  </script>
<!-- <script>
var loadFile = function(e) {
    console.log("===event.target.files[0]",e.target.files[0])
    debugger
    e.preventDefault()
    const csrfToken = document.querySelector('input[name=csrfmiddlewaretoken]').value

    fetch ('{% url "employee_document_api" %}', {
        method: "POST",
        body: new FormData(e.target),
        headers: {'X-CSRFToken' : csrfToken}
    })
        .then((response) => {
            debugger
            if(!response.ok) {
                return response.text().then(text => { throw new Error( "Incorrect Username / Password please try again.") })
            } else {
                return response.text()
            }
        })
        .then((result) => {
            console.log("====",result)
            debugger
            location.reload()
        })
        .catch((err) => {
            $(".error_msg").text(err)
        })
    }

	// var image = document.getElementById('output');
	// image.src = URL.createObjectURL(event.target.files[0]);
// };
</script> -->
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}


<script>


    var current_fs, next_fs, previous_fs; //fieldsets
    var opacity;
    var current = 1;
    var steps = $("fieldset").length;
    
    setProgressBar(current);
    
    $(".next").click(function(){
    
    current_fs = $(this).parent();
    next_fs = $(this).parent().next();
    
    //Add Class Active
    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
    
    //show the next fieldset
    next_fs.show();
    //hide the current fieldset with style
    current_fs.animate({opacity: 0}, {
    step: function(now) {
    // for making fielset appear animation
    opacity = 1 - now;
    
    current_fs.css({
    'display': 'none',
    'position': 'relative'
    });
    next_fs.css({'opacity': opacity});
    },
    duration: 500
    });
    setProgressBar(++current);
    });
    
    $(".previous").click(function(){
    
    current_fs = $(this).parent();
    previous_fs = $(this).parent().prev();
    
    //Remove class active
    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
    
    //show the previous fieldset
    previous_fs.show();
    
    //hide the current fieldset with style
    current_fs.animate({opacity: 0}, {
    step: function(now) {
    // for making fielset appear animation
    opacity = 1 - now;
    
    current_fs.css({
    'display': 'none',
    'position': 'relative'
    });
    previous_fs.css({'opacity': opacity});
    },
    duration: 500
    });
    setProgressBar(--current);
    });
    
    function setProgressBar(curStep){
    var percent = parseFloat(100 / steps) * curStep;
    percent = percent.toFixed();
    $(".progress-bar")
    .css("width",percent+"%")
    }
    
    // $(".submit").click(function(){
    // return false;
    // })

// employee form
console.log("====",document.getElementById('employeeForm'))
document.getElementById('employeeForm').onsubmit = (e) => {
    debugger
    e.preventDefault()
    const csrfToken = document.querySelector('input[name=csrfmiddlewaretoken]').value

    fetch ('{% url "employee_document_api" %}', {
        method: "POST",
        body: new FormData(e.target),
        headers: {'X-CSRFToken' : csrfToken}
    })
        .then((response) => {
            debugger
            if(!response.ok) {
                return response.text().then(text => { throw new Error( "Incorrect Username / Password please try again.") })
            } else {
                return response.text()
            }
        })
        .then((result) => {
            console.log("====",result)
            debugger
            location.reload()
        })
        .catch((err) => {
            $(".error_msg").text(err)
        })
    }


// function _upload(event){
//     debugger
   
//     document.getElementById('file_upload_id').click();
// }

</script>
{% endblock javascripts %}
